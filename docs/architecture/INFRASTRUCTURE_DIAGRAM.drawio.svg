<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!--
  TradingPT Production Infrastructure Architecture
  AWS Blue/Green Deployment with ASG + CodeDeploy

  To edit: Open this file in draw.io (https://app.diagrams.net/)
-->
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1200px" height="900px" viewBox="-0.5 -0.5 1200 900">
  <defs/>
  <g>
    <!-- Title -->
    <text x="600" y="30" fill="#232F3E" font-size="24" font-weight="bold" text-anchor="middle">TradingPT Production Infrastructure - Blue/Green Deployment</text>

    <!-- Users -->
    <rect x="20" y="60" width="100" height="60" rx="10" fill="#FF9900" stroke="#232F3E"/>
    <text x="70" y="95" fill="white" font-size="14" text-anchor="middle">Users</text>

    <!-- Internet -->
    <rect x="180" y="60" width="100" height="60" rx="10" fill="#232F3E" stroke="#232F3E"/>
    <text x="230" y="95" fill="white" font-size="14" text-anchor="middle">Internet</text>

    <!-- VPC Box -->
    <rect x="340" y="50" width="840" height="700" rx="10" fill="none" stroke="#232F3E" stroke-width="2" stroke-dasharray="5,5"/>
    <text x="360" y="75" fill="#232F3E" font-size="16" font-weight="bold">VPC (10.0.0.0/16)</text>

    <!-- Public Subnet -->
    <rect x="360" y="100" width="800" height="120" rx="5" fill="#E8F4E8" stroke="#3F8624"/>
    <text x="380" y="120" fill="#3F8624" font-size="12" font-weight="bold">Public Subnet (10.0.1.0/24, 10.0.2.0/24)</text>

    <!-- ALB -->
    <rect x="500" y="140" width="200" height="60" rx="5" fill="#8C4FFF" stroke="#232F3E"/>
    <text x="600" y="175" fill="white" font-size="14" text-anchor="middle">Application Load Balancer</text>

    <!-- NAT Gateway -->
    <rect x="800" y="140" width="120" height="60" rx="5" fill="#8C4FFF" stroke="#232F3E"/>
    <text x="860" y="175" fill="white" font-size="12" text-anchor="middle">NAT Gateway</text>

    <!-- Private App Subnet -->
    <rect x="360" y="240" width="800" height="260" rx="5" fill="#FFF4E8" stroke="#FF9900"/>
    <text x="380" y="260" fill="#FF9900" font-size="12" font-weight="bold">Private App Subnet (10.0.10.0/24, 10.0.11.0/24)</text>

    <!-- Target Group Box -->
    <rect x="400" y="280" width="340" height="200" rx="5" fill="#E8F0FF" stroke="#3366FF"/>
    <text x="420" y="300" fill="#3366FF" font-size="11" font-weight="bold">Target Group: tpt-prod-api-tg</text>

    <!-- Blue ASG -->
    <rect x="420" y="320" width="140" height="140" rx="5" fill="#0066FF" stroke="#232F3E"/>
    <text x="490" y="345" fill="white" font-size="12" text-anchor="middle" font-weight="bold">Blue (Active)</text>

    <!-- Blue EC2 1 -->
    <rect x="435" y="360" width="110" height="40" rx="3" fill="#FF9900" stroke="#232F3E"/>
    <text x="490" y="385" fill="white" font-size="10" text-anchor="middle">EC2 t3.medium</text>

    <!-- Blue EC2 2 -->
    <rect x="435" y="410" width="110" height="40" rx="3" fill="#FF9900" stroke="#232F3E"/>
    <text x="490" y="435" fill="white" font-size="10" text-anchor="middle">EC2 t3.medium</text>

    <!-- Green ASG -->
    <rect x="580" y="320" width="140" height="140" rx="5" fill="#00CC66" stroke="#232F3E" stroke-dasharray="3,3"/>
    <text x="650" y="345" fill="white" font-size="12" text-anchor="middle" font-weight="bold">Green (Standby)</text>

    <!-- Green EC2 1 -->
    <rect x="595" y="360" width="110" height="40" rx="3" fill="#FF9900" stroke="#232F3E" stroke-dasharray="2,2"/>
    <text x="650" y="385" fill="white" font-size="10" text-anchor="middle">EC2 (new)</text>

    <!-- Green EC2 2 -->
    <rect x="595" y="410" width="110" height="40" rx="3" fill="#FF9900" stroke="#232F3E" stroke-dasharray="2,2"/>
    <text x="650" y="435" fill="white" font-size="10" text-anchor="middle">EC2 (new)</text>

    <!-- CodeDeploy Box -->
    <rect x="780" y="280" width="160" height="80" rx="5" fill="#DD344C" stroke="#232F3E"/>
    <text x="860" y="310" fill="white" font-size="12" text-anchor="middle" font-weight="bold">CodeDeploy</text>
    <text x="860" y="330" fill="white" font-size="10" text-anchor="middle">Blue/Green</text>
    <text x="860" y="350" fill="white" font-size="10" text-anchor="middle">Deployment</text>

    <!-- ASG Info -->
    <rect x="780" y="380" width="160" height="100" rx="5" fill="#FF9900" stroke="#232F3E"/>
    <text x="860" y="405" fill="white" font-size="11" text-anchor="middle" font-weight="bold">Auto Scaling Group</text>
    <text x="860" y="425" fill="white" font-size="9" text-anchor="middle">Health Check: EC2</text>
    <text x="860" y="445" fill="white" font-size="9" text-anchor="middle">Min: 2 | Max: 4</text>
    <text x="860" y="465" fill="white" font-size="9" text-anchor="middle">Grace Period: 300s</text>

    <!-- Private DB Subnet -->
    <rect x="360" y="520" width="800" height="120" rx="5" fill="#FFE8E8" stroke="#DD344C"/>
    <text x="380" y="540" fill="#DD344C" font-size="12" font-weight="bold">Private DB Subnet (10.0.20.0/24, 10.0.21.0/24)</text>

    <!-- RDS -->
    <rect x="450" y="560" width="160" height="60" rx="5" fill="#3366FF" stroke="#232F3E"/>
    <text x="530" y="585" fill="white" font-size="12" text-anchor="middle" font-weight="bold">RDS MySQL</text>
    <text x="530" y="605" fill="white" font-size="10" text-anchor="middle">db.t4g.medium</text>

    <!-- ElastiCache -->
    <rect x="650" y="560" width="160" height="60" rx="5" fill="#DD344C" stroke="#232F3E"/>
    <text x="730" y="585" fill="white" font-size="12" text-anchor="middle" font-weight="bold">ElastiCache</text>
    <text x="730" y="605" fill="white" font-size="10" text-anchor="middle">cache.t4g.micro</text>

    <!-- CI/CD Section -->
    <rect x="20" y="660" width="300" height="220" rx="10" fill="#F0F0F0" stroke="#232F3E"/>
    <text x="40" y="685" fill="#232F3E" font-size="14" font-weight="bold">CI/CD Pipeline</text>

    <!-- GitHub Actions -->
    <rect x="40" y="700" width="120" height="50" rx="5" fill="#24292E" stroke="#232F3E"/>
    <text x="100" y="730" fill="white" font-size="11" text-anchor="middle">GitHub Actions</text>

    <!-- ECR -->
    <rect x="180" y="700" width="120" height="50" rx="5" fill="#FF9900" stroke="#232F3E"/>
    <text x="240" y="730" fill="white" font-size="11" text-anchor="middle">ECR</text>

    <!-- S3 -->
    <rect x="40" y="770" width="120" height="50" rx="5" fill="#3F8624" stroke="#232F3E"/>
    <text x="100" y="800" fill="white" font-size="11" text-anchor="middle">S3 Artifacts</text>

    <!-- CloudWatch -->
    <rect x="180" y="770" width="120" height="50" rx="5" fill="#FF4F8B" stroke="#232F3E"/>
    <text x="240" y="800" fill="white" font-size="11" text-anchor="middle">CloudWatch</text>

    <!-- Arrows -->
    <!-- User to Internet -->
    <line x1="120" y1="90" x2="180" y2="90" stroke="#232F3E" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Internet to ALB -->
    <line x1="280" y1="90" x2="500" y2="170" stroke="#232F3E" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- ALB to Target Group -->
    <line x1="600" y1="200" x2="570" y2="280" stroke="#232F3E" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- EC2 to RDS -->
    <line x1="490" y1="460" x2="530" y2="560" stroke="#3366FF" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- EC2 to Redis -->
    <line x1="650" y1="460" x2="730" y2="560" stroke="#DD344C" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- CodeDeploy to Green -->
    <line x1="780" y1="330" x2="720" y2="390" stroke="#00CC66" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowhead)"/>

    <!-- Legend -->
    <rect x="360" y="660" width="300" height="100" rx="5" fill="#F8F8F8" stroke="#232F3E"/>
    <text x="380" y="680" fill="#232F3E" font-size="12" font-weight="bold">Legend</text>

    <rect x="380" y="695" width="20" height="15" fill="#0066FF"/>
    <text x="410" y="707" fill="#232F3E" font-size="10">Blue (Active Traffic)</text>

    <rect x="380" y="720" width="20" height="15" fill="#00CC66"/>
    <text x="410" y="732" fill="#232F3E" font-size="10">Green (Standby/New)</text>

    <rect x="520" y="695" width="20" height="15" fill="#FF9900"/>
    <text x="550" y="707" fill="#232F3E" font-size="10">AWS Compute</text>

    <rect x="520" y="720" width="20" height="15" fill="#3366FF"/>
    <text x="550" y="732" fill="#232F3E" font-size="10">AWS Database</text>

    <!-- Cost Summary -->
    <rect x="700" y="660" width="200" height="100" rx="5" fill="#232F3E" stroke="#FF9900"/>
    <text x="800" y="685" fill="#FF9900" font-size="12" text-anchor="middle" font-weight="bold">Monthly Cost: ~$242</text>
    <text x="720" y="710" fill="white" font-size="10">EC2 x2: ~$60</text>
    <text x="720" y="725" fill="white" font-size="10">RDS: ~$58</text>
    <text x="720" y="740" fill="white" font-size="10">ElastiCache: ~$12</text>
    <text x="820" y="710" fill="white" font-size="10">ALB: ~$22</text>
    <text x="820" y="725" fill="white" font-size="10">NAT: ~$45</text>
    <text x="820" y="740" fill="white" font-size="10">Other: ~$45</text>

    <!-- Arrow marker definition -->
    <defs>
      <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#232F3E"/>
      </marker>
    </defs>
  </g>
</svg>
