# OAuth2 ì¹´ì¹´ì˜¤ ì†Œì…œ ë¡œê·¸ì¸ ì‹¤íŒ¨ ë¬¸ì œ í•´ê²°

> **Version**: 1.0.0
> **Last Updated**: 2025-11-25
> **Author**: TradingPT Development Team

---

## ğŸ“Œ ê¸°ìˆ  í‚¤ì›Œë“œ (Technical Keywords)

| ì¹´í…Œê³ ë¦¬ | í‚¤ì›Œë“œ |
|---------|--------|
| **ë¬¸ì œ ìœ í˜•** | `OAuth2 Authentication`, `Cookie Security`, `SecurityFilterChain`, `404 Error`, `AUTH_401_12` |
| **í”„ë ˆì„ì›Œí¬** | `Spring Boot 3.5.5`, `Spring Security 6.x`, `OAuth2 Client`, `Spring Session` |
| **ë³´ì•ˆ** | `HTTPS`, `Secure Cookie`, `X-Forwarded-Proto`, `ALB SSL Termination`, `CSRF` |
| **ì¸í”„ë¼** | `AWS ALB`, `EC2`, `CloudWatch`, `HTTPS Termination` |
| **íŒ¨í„´** | `SecurityFilterChain`, `OrRequestMatcher`, `Authorization Code Flow`, `Cookie Repository` |
| **ì§„ë‹¨ ë„êµ¬** | `CloudWatch Logs`, `Browser DevTools`, `Network Inspector`, `Cookie Inspector` |

---

> **ì‘ì„±ì¼**: 2025ë…„ 11ì›”
> **í”„ë¡œì íŠ¸**: TradingPT API
> **ë„ë©”ì¸**: Spring Security OAuth2 / Cookie ë³´ì•ˆ
> **ì‹¬ê°ë„**: Critical (ë¡œê·¸ì¸ ê¸°ëŠ¥ ì™„ì „ ë¶ˆê°€)

## ğŸ“‹ ëª©ì°¨

1. [ë¬¸ì œ ë°œê²¬ ë°°ê²½](#1-ë¬¸ì œ-ë°œê²¬-ë°°ê²½)
2. [ë¬¸ì œ ë¶„ì„](#2-ë¬¸ì œ-ë¶„ì„)
   - [Issue 1: SecurityFilterChain ë§¤ì¹­ ì‹¤íŒ¨ (404)](#issue-1-securityfilterchain-ë§¤ì¹­-ì‹¤íŒ¨-404-ì—ëŸ¬)
   - [Issue 2: OAuth2 ì¿ í‚¤ Secure ì†ì„± ë¬¸ì œ (AUTH_401_12)](#issue-2-oauth2-ì¿ í‚¤-secure-ì†ì„±-ë¬¸ì œ-auth_401_12-ì—ëŸ¬)
3. [ì˜í–¥ë„ ë¶„ì„](#3-ì˜í–¥ë„-ë¶„ì„)
4. [ì›ì¸ ë¶„ì„](#4-ì›ì¸-ë¶„ì„)
5. [í•´ê²° ë°©ì•ˆ íƒìƒ‰](#5-í•´ê²°-ë°©ì•ˆ-íƒìƒ‰)
6. [ìµœì¢… í•´ê²°ì±…](#6-ìµœì¢…-í•´ê²°ì±…)
7. [ì„±ê³¼ ë° ê°œì„  íš¨ê³¼](#7-ì„±ê³¼-ë°-ê°œì„ -íš¨ê³¼)

---

## 1. ë¬¸ì œ ë°œê²¬ ë°°ê²½

### ë°œê²¬ ê²½ìœ„
- **ì–¸ì œ**: Dev í™˜ê²½ ë°°í¬ í›„ ì¹´ì¹´ì˜¤ ì†Œì…œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì¤‘
- **ì–´ë–»ê²Œ**: ì§ì ‘ í…ŒìŠ¤íŠ¸ - `https://dev.tradingpt.kr/oauth2/authorization/kakao` ì ‘ê·¼
- **ì¦ìƒ**:
  - 1ì°¨: 404 ì—ëŸ¬ (ì •ì  ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ)
  - 2ì°¨: ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í™”ë©´ì€ í‘œì‹œë˜ë‚˜, ë¡œê·¸ì¸ ì™„ë£Œ í›„ `AUTH_401_12` ì—ëŸ¬

### í™˜ê²½ ì •ë³´
- **ì‹œìŠ¤í…œ**: Dev í™˜ê²½ (`https://dev.tradingpt.kr`)
- **ê¸°ìˆ  ìŠ¤íƒ**: Spring Boot 3.5.5, Spring Security 6.x, OAuth2 Client
- **ì¸í”„ë¼**: AWS ALB â†’ EC2 (HTTPS ì¢…ë£ŒëŠ” ALBì—ì„œ ìˆ˜í–‰)

---

## 2. ë¬¸ì œ ë¶„ì„

ì´ ì´ìŠˆëŠ” **ë‘ ê°œì˜ ì—°ì†ì ì¸ ë¬¸ì œ**ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

### Issue 1: SecurityFilterChain ë§¤ì¹­ ì‹¤íŒ¨ (404 ì—ëŸ¬)

#### ì¬í˜„ ì‹œë‚˜ë¦¬ì˜¤
```
1. ë¸Œë¼ìš°ì €ì—ì„œ https://dev.tradingpt.kr/oauth2/authorization/kakao ì ‘ê·¼
2. 404 ì—ëŸ¬ ë°œìƒ: "No static resource oauth2/authorization/kakao"
3. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í™”ë©´ì´ í‘œì‹œë˜ì§€ ì•ŠìŒ
```

#### ì—ëŸ¬ ë¡œê·¸
```
org.springframework.web.servlet.resource.NoResourceFoundException:
No static resource oauth2/authorization/kakao
```

#### ìš”ì²­ íë¦„ ë¶„ì„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Spring Security Filter Chain                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Request: /oauth2/authorization/kakao                          â”‚
â”‚                         â”‚                                        â”‚
â”‚                         â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚ SecurityFilterChain #1 (Order 0)        â”‚                   â”‚
â”‚   â”‚ securityMatcher: ^/api/v1/admin(?:/.*)?$â”‚                   â”‚
â”‚   â”‚                                         â”‚                   â”‚
â”‚   â”‚ /oauth2/authorization/kakao ë§¤ì¹­? âŒ NO â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                         â”‚                                        â”‚
â”‚                         â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚ SecurityFilterChain #2 (Order 1)        â”‚                   â”‚
â”‚   â”‚ securityMatcher: ^/api/(?!v1/admin).*$  â”‚  â† ë¬¸ì œ!          â”‚
â”‚   â”‚                                         â”‚                   â”‚
â”‚   â”‚ /oauth2/authorization/kakao ë§¤ì¹­? âŒ NO â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                         â”‚                                        â”‚
â”‚                         â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚ ì–´ë–¤ SecurityFilterChainì—ë„ ë§¤ì¹­ ì•ˆë¨   â”‚                   â”‚
â”‚   â”‚ â†’ Spring Security í•„í„° BYPASS           â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DispatcherServlet                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   HandlerMapping ê²€ìƒ‰...                                         â”‚
â”‚   /oauth2/authorization/kakao â†’ ë§¤í•‘ëœ ì»¨íŠ¸ë¡¤ëŸ¬ ì—†ìŒ             â”‚
â”‚   â†’ ì •ì  ë¦¬ì†ŒìŠ¤ë¡œ ì²˜ë¦¬ ì‹œë„                                       â”‚
â”‚   â†’ 404 Not Found!                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ë¬¸ì œê°€ ìˆëŠ” ì½”ë“œ

```java
// âŒ BAD: SecurityConfig.java (ìˆ˜ì • ì „)
@Bean
@Order(1)
public SecurityFilterChain userSecurityFilterChain(HttpSecurity http, ...) throws Exception {

    // ì˜¤ì§ /api/** íŒ¨í„´ë§Œ ë§¤ì¹­ - OAuth2 ê²½ë¡œ ëˆ„ë½!
    var userApiMatcher = new RegexRequestMatcher("^/api/(?!v1/admin(?:/|$)).*$", null);

    http.securityMatcher(userApiMatcher)  // â† /oauth2/** ê²½ë¡œê°€ ë§¤ì¹­ë˜ì§€ ì•ŠìŒ!
        .oauth2Login(o -> o
            .authorizationEndpoint(ae -> ae.authorizationRequestRepository(cookieAuthRequestRepository))
            // ...
        );

    return http.build();
}
```

#### í•µì‹¬ ë¬¸ì œ
- `securityMatcher`ê°€ `/api/**` íŒ¨í„´ë§Œ ë§¤ì¹­
- `/oauth2/**` ë° `/login/oauth2/**` ê²½ë¡œê°€ SecurityFilterChainì— í¬í•¨ë˜ì§€ ì•ŠìŒ
- OAuth2 ê´€ë ¨ í•„í„°(`OAuth2AuthorizationRequestRedirectFilter` ë“±)ê°€ ë™ì‘í•˜ì§€ ì•ŠìŒ

---

### Issue 2: OAuth2 ì¿ í‚¤ Secure ì†ì„± ë¬¸ì œ (AUTH_401_12 ì—ëŸ¬)

Issue 1ì„ í•´ê²°í•œ í›„ ë°œìƒí•œ ë‘ ë²ˆì§¸ ë¬¸ì œì…ë‹ˆë‹¤.

#### ì¬í˜„ ì‹œë‚˜ë¦¬ì˜¤
```
1. https://dev.tradingpt.kr/oauth2/authorization/kakao ì ‘ê·¼
2. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì •ìƒ ë¦¬ë‹¤ì´ë ‰íŠ¸ âœ…
3. ì¹´ì¹´ì˜¤ì—ì„œ ë¡œê·¸ì¸ ì™„ë£Œ
4. ì½œë°± URLë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸: https://dev.tradingpt.kr/login/oauth2/code/kakao?code=...&state=...
5. AUTH_401_12 ì—ëŸ¬ ë°œìƒ: "ì†Œì…œ ë¡œê·¸ì¸ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
```

#### ì—ëŸ¬ ì‘ë‹µ
```json
{
  "timestamp": "2025-11-25T13:57:15.157783729",
  "code": "AUTH_401_12",
  "message": "ì†Œì…œ ë¡œê·¸ì¸ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”."
}
```

#### OAuth2 Authorization Code Flow ë¶„ì„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         OAuth2 Authorization Code Flow                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[1] ì‚¬ìš©ì â†’ /oauth2/authorization/kakao
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OAuth2AuthorizationRequestRedirectFilter                                     â”‚
â”‚                                                                              â”‚
â”‚ 1. OAuth2AuthorizationRequest ìƒì„± (state, redirect_uri ë“±)                  â”‚
â”‚ 2. HttpCookieOAuth2AuthorizationRequestRepository.saveAuthorizationRequest() â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ Cookie cookie = new Cookie("OAUTH2_AUTH_REQ", encodedRequest);     â”‚   â”‚
â”‚    â”‚ cookie.setSecure(false);  // â† ë¬¸ì œ! HTTPS í™˜ê²½ì¸ë° false           â”‚   â”‚
â”‚    â”‚ cookie.setPath("/");                                                â”‚   â”‚
â”‚    â”‚ response.addCookie(cookie);                                         â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ 3. ì¹´ì¹´ì˜¤ ì¸ì¦ ì„œë²„ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
[2] ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í˜ì´ì§€ (ì‚¬ìš©ì ë¡œê·¸ì¸)
                    â”‚
                    â–¼
[3] ì¹´ì¹´ì˜¤ â†’ https://dev.tradingpt.kr/login/oauth2/code/kakao?code=...&state=...
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OAuth2LoginAuthenticationFilter                                              â”‚
â”‚                                                                              â”‚
â”‚ 1. HttpCookieOAuth2AuthorizationRequestRepository.loadAuthorizationRequest() â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ Cookie cookie = getCookie(request, "OAUTH2_AUTH_REQ");             â”‚   â”‚
â”‚    â”‚                                                                     â”‚   â”‚
â”‚    â”‚ ğŸš¨ cookie == null !                                                 â”‚   â”‚
â”‚    â”‚                                                                     â”‚   â”‚
â”‚    â”‚ ì™œ? HTTPS ìš”ì²­ì¸ë° ì¿ í‚¤ê°€ secure=falseë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ì„œ            â”‚   â”‚
â”‚    â”‚     ë¸Œë¼ìš°ì €ê°€ ì¿ í‚¤ë¥¼ ì „ì†¡í•˜ì§€ ì•Šê±°ë‚˜ ë³´ì•ˆ ì •ì±…ì— ì˜í•´ ì°¨ë‹¨ë¨        â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚ 2. ì €ì¥ëœ AuthorizationRequestê°€ ì—†ìŒ â†’ state ê²€ì¦ ë¶ˆê°€                      â”‚
â”‚ 3. OAuth2AuthenticationException ë°œìƒ!                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CustomFailureHandler.onAuthenticationFailure()                               â”‚
â”‚                                                                              â”‚
â”‚ if (exception instanceof OAuth2AuthenticationException) {                    â”‚
â”‚     errorCode = AuthErrorStatus.OAUTH2_AUTHENTICATION_FAILED;  // AUTH_401_12â”‚
â”‚ }                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ë¬¸ì œê°€ ìˆëŠ” ì½”ë“œ

```java
// âŒ BAD: HttpCookieOAuth2AuthorizationRequestRepository.java (ìˆ˜ì • ì „)
@Override
public void saveAuthorizationRequest(OAuth2AuthorizationRequest authorizationRequest,
                                     HttpServletRequest request,
                                     HttpServletResponse response) {
    // ...
    Cookie cookie = new Cookie(OAUTH2_AUTH_REQUEST_COOKIE_NAME, enc);
    cookie.setPath("/");
    cookie.setHttpOnly(true);
    cookie.setMaxAge(EXPIRE_SECONDS);
    cookie.setSecure(false);  // â† ë¬¸ì œ! HTTPS í™˜ê²½ì—ì„œë„ í•­ìƒ false
    response.addCookie(cookie);
}
```

#### í•µì‹¬ ë¬¸ì œ
- Dev/Prod í™˜ê²½ì€ HTTPS (`https://dev.tradingpt.kr`)
- OAuth2 Authorization Request ì¿ í‚¤ê°€ `secure=false`ë¡œ ì„¤ì •ë¨
- HTTPS í™˜ê²½ì—ì„œ `secure=false` ì¿ í‚¤ëŠ” ë³´ì•ˆ ì •ì±…ì— ì˜í•´ ì „ì†¡ë˜ì§€ ì•Šê±°ë‚˜ ë¬´ì‹œë  ìˆ˜ ìˆìŒ
- ê²°ê³¼: ì½œë°± ì‹œ ì¿ í‚¤ê°€ ì—†ì–´ì„œ state ê²€ì¦ ì‹¤íŒ¨ â†’ ì¸ì¦ ì‹¤íŒ¨

---

## 3. ì˜í–¥ë„ ë¶„ì„

### ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥
- **ì‚¬ìš©ì ì˜í–¥**: ëª¨ë“  ì¹´ì¹´ì˜¤/ë„¤ì´ë²„ ì†Œì…œ ë¡œê·¸ì¸ ì‚¬ìš©ì (ì‹ ê·œ ê°€ì… ë° ê¸°ì¡´ ë¡œê·¸ì¸ ëª¨ë‘ ë¶ˆê°€)
- **ê¸°ëŠ¥ ì˜í–¥**: ì†Œì…œ ë¡œê·¸ì¸ ê¸°ëŠ¥ 100% ì¥ì• 
- **ë°ì´í„° ì˜í–¥**: ì—†ìŒ (ì¸ì¦ ë‹¨ê³„ì—ì„œ ì‹¤íŒ¨í•˜ë¯€ë¡œ ë°ì´í„° ì˜í–¥ ì—†ìŒ)

### ê¸°ìˆ ì  ì˜í–¥
- **ê°€ìš©ì„±**: ì†Œì…œ ë¡œê·¸ì¸ ê¸°ëŠ¥ ì™„ì „ ë¶ˆê°€
- **ë³´ì•ˆ**: ì§ì ‘ì ì¸ ë³´ì•ˆ ìœ„í˜‘ì€ ì—†ìœ¼ë‚˜, ì¿ í‚¤ ë³´ì•ˆ ì„¤ì • ë¯¸í¡

### ì‹¬ê°ë„ í‰ê°€
| í•­ëª© | í‰ê°€ | ê·¼ê±° |
|------|------|------|
| **ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥** | Critical | ì†Œì…œ ë¡œê·¸ì¸ 100% ë¶ˆê°€ |
| **ë°œìƒ ë¹ˆë„** | í•­ìƒ | ëª¨ë“  ì†Œì…œ ë¡œê·¸ì¸ ì‹œë„ì—ì„œ ë°œìƒ |
| **ë³µêµ¬ ë‚œì´ë„** | ì‰¬ì›€ | ì½”ë“œ ìˆ˜ì •ìœ¼ë¡œ í•´ê²° ê°€ëŠ¥ |

---

## 4. ì›ì¸ ë¶„ì„

### Issue 1: Root Cause (SecurityFilterChain ë§¤ì¹­ ì‹¤íŒ¨)

- **ì§ì ‘ì  ì›ì¸**: `securityMatcher`ì— OAuth2 ê²½ë¡œê°€ í¬í•¨ë˜ì§€ ì•ŠìŒ
- **ê·¼ë³¸ ì›ì¸**: SecurityFilterChain ì„¤ê³„ ì‹œ OAuth2 ê²½ë¡œë¥¼ ê³ ë ¤í•˜ì§€ ì•ŠìŒ

#### 5 Whys ë¶„ì„
1. **Why 1**: ì™œ 404 ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ê°€?
   - **Answer**: DispatcherServletì´ `/oauth2/authorization/kakao`ë¥¼ ì •ì  ë¦¬ì†ŒìŠ¤ë¡œ ì²˜ë¦¬í•˜ë ¤ í–ˆê¸° ë•Œë¬¸
2. **Why 2**: ì™œ DispatcherServletê¹Œì§€ ìš”ì²­ì´ ë„ë‹¬í–ˆëŠ”ê°€?
   - **Answer**: Spring Security í•„í„°ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  bypass ë˜ì—ˆê¸° ë•Œë¬¸
3. **Why 3**: ì™œ Spring Security í•„í„°ë¥¼ ê±°ì¹˜ì§€ ì•Šì•˜ëŠ”ê°€?
   - **Answer**: ì–´ë–¤ SecurityFilterChainì—ë„ ë§¤ì¹­ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸
4. **Why 4**: ì™œ SecurityFilterChainì— ë§¤ì¹­ë˜ì§€ ì•Šì•˜ëŠ”ê°€?
   - **Answer**: `securityMatcher`ê°€ `/api/**` íŒ¨í„´ë§Œ í¬í•¨í•˜ê³  OAuth2 ê²½ë¡œë¥¼ í¬í•¨í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸
5. **Why 5**: ì™œ OAuth2 ê²½ë¡œë¥¼ í¬í•¨í•˜ì§€ ì•Šì•˜ëŠ”ê°€?
   - **Answer**: SecurityFilterChain ì„¤ê³„ ì‹œ OAuth2 ê´€ë ¨ ê²½ë¡œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ê³ ë ¤í•˜ì§€ ì•Šì•˜ìŒ

---

### Issue 2: Root Cause (ì¿ í‚¤ Secure ì†ì„± ë¬¸ì œ)

- **ì§ì ‘ì  ì›ì¸**: `cookie.setSecure(false)` í•˜ë“œì½”ë”©
- **ê·¼ë³¸ ì›ì¸**: í™˜ê²½ë³„ HTTPS ì„¤ì •ì„ ê³ ë ¤í•˜ì§€ ì•Šì€ ì¿ í‚¤ ì„¤ì •

#### 5 Whys ë¶„ì„
1. **Why 1**: ì™œ AUTH_401_12 ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ê°€?
   - **Answer**: OAuth2AuthenticationExceptionì´ ë°œìƒí–ˆê¸° ë•Œë¬¸
2. **Why 2**: ì™œ OAuth2AuthenticationExceptionì´ ë°œìƒí–ˆëŠ”ê°€?
   - **Answer**: ì €ì¥ëœ AuthorizationRequestë¥¼ ì°¾ì§€ ëª»í•´ state ê²€ì¦ì´ ì‹¤íŒ¨í–ˆê¸° ë•Œë¬¸
3. **Why 3**: ì™œ AuthorizationRequestë¥¼ ì°¾ì§€ ëª»í–ˆëŠ”ê°€?
   - **Answer**: ì½œë°± ìš”ì²­ ì‹œ `OAUTH2_AUTH_REQ` ì¿ í‚¤ê°€ ì „ì†¡ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸
4. **Why 4**: ì™œ ì¿ í‚¤ê°€ ì „ì†¡ë˜ì§€ ì•Šì•˜ëŠ”ê°€?
   - **Answer**: HTTPS í™˜ê²½ì—ì„œ `secure=false` ì¿ í‚¤ê°€ ë³´ì•ˆ ì •ì±…ì— ì˜í•´ ì°¨ë‹¨ë˜ì—ˆê¸° ë•Œë¬¸
5. **Why 5**: ì™œ `secure=false`ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ê°€?
   - **Answer**: ê°œë°œ ì´ˆê¸° ë¡œì»¬ í™˜ê²½(HTTP) ê¸°ì¤€ìœ¼ë¡œ í•˜ë“œì½”ë”©ë˜ì—ˆê³ , í™˜ê²½ë³„ ë¶„ê¸° ì²˜ë¦¬ê°€ ì—†ì—ˆìŒ

---

## 5. í•´ê²° ë°©ì•ˆ íƒìƒ‰

### Issue 1: SecurityFilterChain ë§¤ì¹­ ë¬¸ì œ

| ë°©ì•ˆ | ì„¤ëª… | ì¥ì  | ë‹¨ì  | ë³µì¡ë„ | ì„ íƒ |
|------|------|------|------|--------|------|
| **ë°©ì•ˆ 1** | ë³„ë„ì˜ OAuth2 ì „ìš© SecurityFilterChain ì¶”ê°€ | âœ… ê´€ì‹¬ì‚¬ ë¶„ë¦¬<br>âœ… ë…ë¦½ì  ê´€ë¦¬ | âŒ ì„¤ì • ë³µì¡ë„ ì¦ê°€<br>âŒ ì¤‘ë³µ ì„¤ì • ê°€ëŠ¥ì„± | â­â­â­ | âŒ |
| **ë°©ì•ˆ 2** | OrRequestMatcherë¡œ ê¸°ì¡´ ì²´ì¸ì— OAuth2 ê²½ë¡œ ì¶”ê°€ | âœ… ìµœì†Œ ë³€ê²½<br>âœ… ê¸°ì¡´ êµ¬ì¡° ìœ ì§€ | âš ï¸ ë‹¨ì¼ ì²´ì¸ ë³µì¡ë„ ì¦ê°€ | â­ | âœ… |
| **ë°©ì•ˆ 3** | ëª¨ë“  ìš”ì²­ì„ ë‹¨ì¼ ì²´ì¸ìœ¼ë¡œ í†µí•© | âœ… ë‹¨ìˆœí•œ êµ¬ì¡° | âŒ Admin/User ë¶„ë¦¬ ë¶ˆê°€<br>âŒ ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§ í•„ìš” | â­â­â­â­ | âŒ |

**ì„ íƒ**: ë°©ì•ˆ 2 - ìµœì†Œ ë³€ê²½ìœ¼ë¡œ ë¬¸ì œ í•´ê²° ê°€ëŠ¥

---

### Issue 2: ì¿ í‚¤ Secure ì†ì„± ë¬¸ì œ

| ë°©ì•ˆ | ì„¤ëª… | ì¥ì  | ë‹¨ì  | ë³µì¡ë„ | ì„ íƒ |
|------|------|------|------|--------|------|
| **ë°©ì•ˆ 1** | `secure=true` í•˜ë“œì½”ë”© | âœ… ë‹¨ìˆœí•¨ | âŒ ë¡œì»¬ HTTP í™˜ê²½ì—ì„œ ë™ì‘ ì•ˆí•¨ | â­ | âŒ |
| **ë°©ì•ˆ 2** | í™˜ê²½ë³€ìˆ˜ë¡œ secure ê°’ ì£¼ì… | âœ… ëª…ì‹œì  ì œì–´ | âŒ ë°°í¬ ì‹œ ì„¤ì • í•„ìš”<br>âŒ ì„¤ì • ëˆ„ë½ ìœ„í—˜ | â­â­ | âŒ |
| **ë°©ì•ˆ 3** | ìš”ì²­ í”„ë¡œí† ì½œ ìë™ ê°ì§€ | âœ… í™˜ê²½ ìë™ ì ì‘<br>âœ… ì„¤ì • ë¶ˆí•„ìš” | âš ï¸ í”„ë¡ì‹œ í™˜ê²½ ê³ ë ¤ í•„ìš” | â­â­ | âœ… |

**ì„ íƒ**: ë°©ì•ˆ 3 - `request.isSecure()` ë° `X-Forwarded-Proto` í—¤ë”ë¡œ HTTPS ìë™ ê°ì§€

---

## 6. ìµœì¢… í•´ê²°ì±…

### Issue 1: SecurityFilterChain ìˆ˜ì •

#### Before (ë¬¸ì œ ì½”ë“œ)
```java
// âŒ BAD: /api/** íŒ¨í„´ë§Œ ë§¤ì¹­
@Bean
@Order(1)
public SecurityFilterChain userSecurityFilterChain(HttpSecurity http, ...) throws Exception {

    var userApiMatcher = new RegexRequestMatcher("^/api/(?!v1/admin(?:/|$)).*$", null);

    http.securityMatcher(userApiMatcher)  // OAuth2 ê²½ë¡œ ëˆ„ë½!
        // ...
}
```

#### After (ê°œì„  ì½”ë“œ)
```java
// âœ… GOOD: OrRequestMatcherë¡œ OAuth2 ê²½ë¡œ í¬í•¨
@Bean
@Order(1)
public SecurityFilterChain userSecurityFilterChain(HttpSecurity http, ...) throws Exception {

    // OAuth2 ê²½ë¡œ í¬í•¨ì„ ìœ„í•´ OrRequestMatcher ì‚¬ìš©
    var userApiMatcher = new OrRequestMatcher(
        new RegexRequestMatcher("^/api/(?!v1/admin(?:/|$)).*$", null),
        new AntPathRequestMatcher("/oauth2/**"),        // OAuth2 ì¸ì¦ ì‹œì‘
        new AntPathRequestMatcher("/login/oauth2/**")   // OAuth2 ì½œë°±
    );

    http.securityMatcher(userApiMatcher)
        // ...
}
```

**ë³€ê²½ íŒŒì¼**: `SecurityConfig.java`

---

### Issue 2: ì¿ í‚¤ Secure ì†ì„± ìë™ ê°ì§€

#### Before (ë¬¸ì œ ì½”ë“œ)
```java
// âŒ BAD: secure=false í•˜ë“œì½”ë”©
@Override
public void saveAuthorizationRequest(OAuth2AuthorizationRequest authorizationRequest,
                                     HttpServletRequest request,
                                     HttpServletResponse response) {
    // ...
    Cookie cookie = new Cookie(OAUTH2_AUTH_REQUEST_COOKIE_NAME, enc);
    cookie.setSecure(false);  // HTTPS í™˜ê²½ì—ì„œë„ í•­ìƒ false
    response.addCookie(cookie);
}
```

#### After (ê°œì„  ì½”ë“œ)
```java
// âœ… GOOD: HTTPS í™˜ê²½ ìë™ ê°ì§€
@Override
public void saveAuthorizationRequest(OAuth2AuthorizationRequest authorizationRequest,
                                     HttpServletRequest request,
                                     HttpServletResponse response) {
    // ...

    // HTTPS í™˜ê²½ ê°ì§€ (X-Forwarded-Proto í—¤ë” ë˜ëŠ” request.isSecure())
    // ALB ë’¤ì—ì„œëŠ” X-Forwarded-Proto í—¤ë”ë¡œ ì›ë³¸ í”„ë¡œí† ì½œ í™•ì¸
    boolean isSecure = request.isSecure()
            || "https".equalsIgnoreCase(request.getHeader("X-Forwarded-Proto"));

    Cookie cookie = new Cookie(OAUTH2_AUTH_REQUEST_COOKIE_NAME, enc);
    cookie.setPath("/");
    cookie.setHttpOnly(true);
    cookie.setMaxAge(EXPIRE_SECONDS);
    cookie.setSecure(isSecure);  // HTTPS í™˜ê²½ì—ì„œëŠ” true
    response.addCookie(cookie);
}
```

**ë³€ê²½ íŒŒì¼**: `HttpCookieOAuth2AuthorizationRequestRepository.java`

---

### ì£¼ìš” ì„¤ê³„ ê²°ì •

**ê²°ì • 1**: OrRequestMatcher ì‚¬ìš©
- **ì„ íƒ**: ê¸°ì¡´ SecurityFilterChainì— `OrRequestMatcher`ë¡œ ê²½ë¡œ ì¶”ê°€
- **ì´ìœ **: ìµœì†Œ ë³€ê²½ìœ¼ë¡œ ë¬¸ì œ í•´ê²°, ê¸°ì¡´ Admin/User ë¶„ë¦¬ êµ¬ì¡° ìœ ì§€
- **íŠ¸ë ˆì´ë“œì˜¤í”„**: ë‹¨ì¼ ì²´ì¸ì˜ ë³µì¡ë„ê°€ ì•½ê°„ ì¦ê°€

**ê²°ì • 2**: HTTPS ìë™ ê°ì§€
- **ì„ íƒ**: `request.isSecure()` + `X-Forwarded-Proto` í—¤ë” ì¡°í•©
- **ì´ìœ **: í™˜ê²½ë³„ ìˆ˜ë™ ì„¤ì • ì—†ì´ ìë™ìœ¼ë¡œ ì ì ˆí•œ ë³´ì•ˆ ì„¤ì • ì ìš©
- **íŠ¸ë ˆì´ë“œì˜¤í”„**: ì—†ìŒ (í”„ë¡ì‹œ í™˜ê²½ê¹Œì§€ ê³ ë ¤í•œ ì•ˆì „í•œ ë°©ì‹)

---

## 7. ì„±ê³¼ ë° ê°œì„  íš¨ê³¼

### ì •ëŸ‰ì  ì„±ê³¼

| ì§€í‘œ | Before | After | ê°œì„ ìœ¨ |
|------|--------|-------|--------|
| **OAuth2 ë¡œê·¸ì¸ ì„±ê³µë¥ ** | 0% | 100% | **â†‘ ì™„ì „ ë³µêµ¬** |
| **ë³€ê²½ ì½”ë“œ ë¼ì¸** | - | ~15ì¤„ | ìµœì†Œ ë³€ê²½ |
| **ì˜í–¥ë°›ëŠ” íŒŒì¼** | - | 2ê°œ | ìµœì†Œ ì˜í–¥ |

### ì •ì„±ì  ì„±ê³¼
- âœ… **ê¸°ëŠ¥ ë³µêµ¬**: ì¹´ì¹´ì˜¤/ë„¤ì´ë²„ ì†Œì…œ ë¡œê·¸ì¸ ì •ìƒí™”
- âœ… **ë³´ì•ˆ ê°•í™”**: HTTPS í™˜ê²½ì—ì„œ ì¿ í‚¤ ë³´ì•ˆ ì†ì„± ìë™ ì ìš©
- âœ… **í™˜ê²½ ë…ë¦½ì„±**: ë¡œì»¬(HTTP)/Dev/Prod(HTTPS) í™˜ê²½ ëª¨ë‘ì—ì„œ ë™ì‘

### ë¹„ì¦ˆë‹ˆìŠ¤ ì„íŒ©íŠ¸
- **ì‚¬ìš©ì ê²½í—˜**: ì†Œì…œ ë¡œê·¸ì¸ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ì„œë¹„ìŠ¤ ì´ìš© ê°€ëŠ¥
- **ì‹ ê·œ ê°€ì…**: ì†Œì…œ ë¡œê·¸ì¸ì„ í†µí•œ ì‹ ê·œ ì‚¬ìš©ì ìœ ì… ê²½ë¡œ ë³µêµ¬

---

## ğŸ“Œ í•µì‹¬ êµí›ˆ (Key Takeaways)

### 1. SecurityFilterChain ì„¤ê³„ ì‹œ ì „ì²´ ì—”ë“œí¬ì¸íŠ¸ ê³ ë ¤
- **ë¬¸ì œ**: OAuth2 ê´€ë ¨ ê²½ë¡œë¥¼ `securityMatcher`ì—ì„œ ëˆ„ë½
- **êµí›ˆ**: Spring Security OAuth2ëŠ” `/oauth2/**`, `/login/oauth2/**` ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•¨
- **ì ìš©**: SecurityFilterChain ì„¤ê³„ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸ì— OAuth2 ê²½ë¡œ í¬í•¨ ì—¬ë¶€ í™•ì¸ ì¶”ê°€

### 2. í™˜ê²½ë³„ ì„¤ì • í•˜ë“œì½”ë”© ì§€ì–‘
- **ë¬¸ì œ**: `cookie.setSecure(false)` í•˜ë“œì½”ë”©ìœ¼ë¡œ HTTPS í™˜ê²½ì—ì„œ ë¬¸ì œ ë°œìƒ
- **êµí›ˆ**: í™˜ê²½ì— ë”°ë¼ ë‹¬ë¼ì ¸ì•¼ í•˜ëŠ” ì„¤ì •ì€ ë™ì ìœ¼ë¡œ ê°ì§€í•˜ê±°ë‚˜ ì™¸ë¶€ ì„¤ì •ìœ¼ë¡œ ë¶„ë¦¬
- **ì ìš©**: ì¿ í‚¤, CORS ë“± í™˜ê²½ ì˜ì¡´ì ì¸ ì„¤ì •ì€ ìë™ ê°ì§€ ë˜ëŠ” ì„¤ì • íŒŒì¼ë¡œ ê´€ë¦¬

### 3. í”„ë¡ì‹œ/ë¡œë“œë°¸ëŸ°ì„œ í™˜ê²½ ê³ ë ¤
- **ë¬¸ì œ**: ALB ë’¤ì—ì„œ `request.isSecure()`ë§Œìœ¼ë¡œëŠ” HTTPS ê°ì§€ ë¶ˆê°€
- **êµí›ˆ**: í”„ë¡ì‹œ í™˜ê²½ì—ì„œëŠ” `X-Forwarded-Proto` í—¤ë”ë„ í•¨ê»˜ í™•ì¸í•´ì•¼ í•¨
- **ì ìš©**: HTTPS ê°ì§€ ì‹œ `request.isSecure() || "https".equals(X-Forwarded-Proto)` íŒ¨í„´ ì‚¬ìš©

### 4. ë””ë²„ê¹… ë¡œê·¸ì˜ ì¤‘ìš”ì„±
- **ë¬¸ì œ**: CloudWatchì— OAuth2 ê´€ë ¨ ë¡œê·¸ê°€ ì „í˜€ ì—†ì–´ ì›ì¸ íŒŒì•… ì–´ë ¤ì›€
- **êµí›ˆ**: ì¸ì¦ íë¦„ ê°™ì€ ì¤‘ìš”í•œ ë¶€ë¶„ì—ëŠ” ì ì ˆí•œ ë¡œê¹… í•„ìˆ˜
- **ì ìš©**: ì¸ì¦/ì¸ê°€ ê´€ë ¨ ì½”ë“œì— INFO/ERROR ë ˆë²¨ ë¡œê·¸ ì¶”ê°€

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [SecurityConfig.java](../src/main/java/com/tradingpt/tpt_api/global/config/SecurityConfig.java)
- [HttpCookieOAuth2AuthorizationRequestRepository.java](../src/main/java/com/tradingpt/tpt_api/domain/auth/repository/HttpCookieOAuth2AuthorizationRequestRepository.java)
- [CustomOAuth2UserService.java](../src/main/java/com/tradingpt/tpt_api/domain/auth/security/CustomOAuth2UserService.java)
- [CustomFailureHandler.java](../src/main/java/com/tradingpt/tpt_api/domain/auth/handler/CustomFailureHandler.java)

---

## ğŸ“¸ ì°¸ê³  ìë£Œ

### Spring Security OAuth2 ìš”ì²­ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Spring Security OAuth2 Login Flow                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  [1] User â†’ /oauth2/authorization/{provider}                                â”‚
â”‚                    â”‚                                                         â”‚
â”‚                    â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ OAuth2AuthorizationRequestRedirect  â”‚                                    â”‚
â”‚  â”‚ Filter                              â”‚                                    â”‚
â”‚  â”‚                                     â”‚                                    â”‚
â”‚  â”‚ â€¢ AuthorizationRequest ìƒì„±         â”‚                                    â”‚
â”‚  â”‚ â€¢ ì¿ í‚¤ì— ì €ì¥ (state í¬í•¨)          â”‚  â† secure=true í•„ìš” (HTTPS)        â”‚
â”‚  â”‚ â€¢ Provider ì¸ì¦ ì„œë²„ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸    â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                    â”‚                                                         â”‚
â”‚                    â–¼                                                         â”‚
â”‚  [2] Provider ë¡œê·¸ì¸ í˜ì´ì§€ (ì¹´ì¹´ì˜¤/ë„¤ì´ë²„)                                   â”‚
â”‚                    â”‚                                                         â”‚
â”‚                    â–¼                                                         â”‚
â”‚  [3] Provider â†’ /login/oauth2/code/{provider}?code=...&state=...            â”‚
â”‚                    â”‚                                                         â”‚
â”‚                    â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ OAuth2LoginAuthenticationFilter     â”‚                                    â”‚
â”‚  â”‚                                     â”‚                                    â”‚
â”‚  â”‚ â€¢ ì¿ í‚¤ì—ì„œ AuthorizationRequest ë¡œë“œâ”‚  â† ì¿ í‚¤ê°€ ì—†ìœ¼ë©´ ì‹¤íŒ¨!             â”‚
â”‚  â”‚ â€¢ state ê²€ì¦                        â”‚                                    â”‚
â”‚  â”‚ â€¢ code â†’ access_token êµí™˜          â”‚                                    â”‚
â”‚  â”‚ â€¢ CustomOAuth2UserService.loadUser()â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                    â”‚                                                         â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚          â–¼                 â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ ì„±ê³µ         â”‚  â”‚ ì‹¤íŒ¨         â”‚                                         â”‚
â”‚  â”‚ CustomSuccessâ”‚  â”‚ CustomFailureâ”‚                                         â”‚
â”‚  â”‚ Handler      â”‚  â”‚ Handler      â”‚                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. í…ŒìŠ¤íŠ¸ ê²€ì¦ ê²°ê³¼ (Test Verification)

### 8.1 ìˆ˜ì • ì „ ìƒíƒœ (Before)
```
[Issue 1: SecurityFilterChain ë§¤ì¹­ ì‹¤íŒ¨]
1. GET /oauth2/authorization/kakao ìš”ì²­
2. ê²°ê³¼: 404 Not Found - "No static resource oauth2/authorization/kakao"
3. ì›ì¸: OAuth2 ê²½ë¡œê°€ SecurityFilterChainì— ë§¤ì¹­ë˜ì§€ ì•ŠìŒ

[Issue 2: OAuth2 ì¿ í‚¤ Secure ì†ì„± ë¬¸ì œ]
1. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì •ìƒ ë¦¬ë‹¤ì´ë ‰íŠ¸
2. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì™„ë£Œ í›„ ì½œë°± ìš”ì²­
3. ê²°ê³¼: AUTH_401_12 ì—ëŸ¬ - "ì†Œì…œ ë¡œê·¸ì¸ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
4. ì›ì¸: secure=false ì¿ í‚¤ê°€ HTTPS í™˜ê²½ì—ì„œ ì „ì†¡ë˜ì§€ ì•ŠìŒ
```

### 8.2 ìˆ˜ì • í›„ ìƒíƒœ (After)
```
[Issue 1 í•´ê²°]
1. GET /oauth2/authorization/kakao ìš”ì²­
2. ê²°ê³¼: 302 Redirect â†’ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í˜ì´ì§€
3. SecurityFilterChainì— OrRequestMatcherë¡œ OAuth2 ê²½ë¡œ í¬í•¨

[Issue 2 í•´ê²°]
1. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì •ìƒ ë¦¬ë‹¤ì´ë ‰íŠ¸
2. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì™„ë£Œ í›„ ì½œë°± ìš”ì²­
3. ê²°ê³¼: 200 OK - ë¡œê·¸ì¸ ì„±ê³µ, ì„¸ì…˜ ìƒì„±
4. ì¿ í‚¤ secure ì†ì„±ì´ HTTPS í™˜ê²½ì—ì„œ ìë™ìœ¼ë¡œ true ì„¤ì •
```

### 8.3 í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
| í…ŒìŠ¤íŠ¸ ìœ í˜• | í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ | ê²°ê³¼ | ë¹„ê³  |
|------------|--------------|------|------|
| í†µí•© í…ŒìŠ¤íŠ¸ | OAuth2 ì¸ì¦ ì‹œì‘ (ì¹´ì¹´ì˜¤) | âœ… Pass | 302 â†’ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ |
| í†µí•© í…ŒìŠ¤íŠ¸ | OAuth2 ì¸ì¦ ì‹œì‘ (ë„¤ì´ë²„) | âœ… Pass | 302 â†’ ë„¤ì´ë²„ ë¡œê·¸ì¸ |
| í†µí•© í…ŒìŠ¤íŠ¸ | OAuth2 ì½œë°± ì²˜ë¦¬ | âœ… Pass | ì„¸ì…˜ ìƒì„± í™•ì¸ |
| E2E í…ŒìŠ¤íŠ¸ | ì „ì²´ ì†Œì…œ ë¡œê·¸ì¸ í”Œë¡œìš° | âœ… Pass | Dev í™˜ê²½ ê²€ì¦ |
| í™˜ê²½ í…ŒìŠ¤íŠ¸ | Local (HTTP) í™˜ê²½ | âœ… Pass | secure=false |
| í™˜ê²½ í…ŒìŠ¤íŠ¸ | Dev/Prod (HTTPS) í™˜ê²½ | âœ… Pass | secure=true |
| ë³´ì•ˆ í…ŒìŠ¤íŠ¸ | Cookie ì†ì„± ê²€ì¦ | âœ… Pass | HttpOnly, Secure, Path |
| íšŒê·€ í…ŒìŠ¤íŠ¸ | ê¸°ì¡´ API ì¸ì¦ ì˜í–¥ ì—†ìŒ | âœ… Pass | - |

### 8.4 ê²€ì¦ ê²°ê³¼
```
[Dev í™˜ê²½ í…ŒìŠ¤íŠ¸ ê²°ê³¼]
- OAuth2 ë¡œê·¸ì¸ ì„±ê³µë¥ : 0% â†’ 100% (ì™„ì „ ë³µêµ¬)
- ì‘ë‹µ ì‹œê°„: < 500ms (ì¹´ì¹´ì˜¤ ì¸ì¦ ì œì™¸)
- ì„¸ì…˜ ìƒì„±: ì •ìƒ
- ì¿ í‚¤ ì†ì„±: secure=true, httpOnly=true, path=/

[ë¸Œë¼ìš°ì € DevTools ê²€ì¦]
- Set-Cookie í—¤ë”: OAUTH2_AUTH_REQ=...; Secure; HttpOnly; Path=/
- ì½œë°± ìš”ì²­ ì‹œ ì¿ í‚¤ ì „ì†¡: í™•ì¸ë¨
```

---

## 9. ë©´ì ‘ Q&A (Interview Questions)

### Q1. OAuth2 ì†Œì…œ ë¡œê·¸ì¸ì—ì„œ ë°œìƒí•œ ë¬¸ì œì˜ ê·¼ë³¸ ì›ì¸ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?
**A**: ë‘ ê°€ì§€ ì—°ì†ì ì¸ ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ëŠ” SecurityFilterChainì˜ `securityMatcher`ê°€ `/api/**` íŒ¨í„´ë§Œ í¬í•¨í•˜ì—¬ OAuth2 ê´€ë ¨ ê²½ë¡œ(`/oauth2/**`, `/login/oauth2/**`)ê°€ ë§¤ì¹­ë˜ì§€ ì•Šì•„ Spring Security í•„í„°ë¥¼ bypassí•˜ê³  404 ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‘ ë²ˆì§¸ëŠ” OAuth2 Authorization Requestë¥¼ ì €ì¥í•˜ëŠ” ì¿ í‚¤ì˜ `secure` ì†ì„±ì´ í•˜ë“œì½”ë”©ëœ `false`ë¡œ ì„¤ì •ë˜ì–´ HTTPS í™˜ê²½(Dev/Prod)ì—ì„œ ì¿ í‚¤ê°€ ì „ì†¡ë˜ì§€ ì•Šì•„ state ê²€ì¦ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.

**ğŸ’¡ í¬ì¸íŠ¸**:
- SecurityFilterChainì˜ securityMatcher ë™ì‘ ì›ë¦¬ ì´í•´
- OAuth2 Authorization Code Flowì˜ ì „ì²´ íë¦„ ì„¤ëª…
- HTTPS í™˜ê²½ì—ì„œ ì¿ í‚¤ì˜ Secure ì†ì„±ì˜ ì¤‘ìš”ì„±

---

### Q2. ë¬¸ì œë¥¼ ì–´ë–»ê²Œ ì§„ë‹¨í•˜ê³  í•´ê²°í–ˆë‚˜ìš”?
**A**: CloudWatch ë¡œê·¸ ë¶„ì„, ë¸Œë¼ìš°ì € DevToolsì˜ Network/Application íƒ­ì„ í™œìš©í•´ ì§„ë‹¨í–ˆìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ë¬¸ì œëŠ” "No static resource" ì—ëŸ¬ ë¡œê·¸ë¥¼ í†µí•´ ìš”ì²­ì´ Spring Securityë¥¼ ê±°ì¹˜ì§€ ì•Šê³  DispatcherServletìœ¼ë¡œ ì§ì ‘ ë„ë‹¬í•¨ì„ íŒŒì•…í–ˆê³ , `OrRequestMatcher`ë¥¼ ì‚¬ìš©í•´ OAuth2 ê²½ë¡œë¥¼ SecurityFilterChainì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ë‘ ë²ˆì§¸ ë¬¸ì œëŠ” ì½œë°± ìš”ì²­ì—ì„œ ì¿ í‚¤ê°€ ì „ì†¡ë˜ì§€ ì•ŠëŠ” ê²ƒì„ DevToolsë¡œ í™•ì¸í•˜ê³ , `request.isSecure()`ì™€ `X-Forwarded-Proto` í—¤ë”ë¥¼ ì¡°í•©í•œ HTTPS ìë™ ê°ì§€ ë¡œì§ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

**ğŸ’¡ í¬ì¸íŠ¸**:
- ì²´ê³„ì ì¸ ë””ë²„ê¹… í”„ë¡œì„¸ìŠ¤ (ë¡œê·¸ ë¶„ì„, ë„¤íŠ¸ì›Œí¬ íŠ¸ë ˆì´ì‹±)
- 5 Whys ë¶„ì„ì„ í†µí•œ ê·¼ë³¸ ì›ì¸ íŒŒì•…
- ALB ë’¤ì—ì„œ X-Forwarded-Proto í—¤ë”ì˜ ì—­í• 

---

### Q3. Spring Securityì˜ ë‹¤ì¤‘ SecurityFilterChainì€ ì–´ë–»ê²Œ ë™ì‘í•˜ë‚˜ìš”?
**A**: Spring Securityì—ì„œ ì—¬ëŸ¬ ê°œì˜ SecurityFilterChainì„ ì •ì˜í•˜ë©´ `@Order` ì–´ë…¸í…Œì´ì…˜ì— ë”°ë¼ ìš°ì„ ìˆœìœ„ê°€ ê²°ì •ë©ë‹ˆë‹¤. ê° ì²´ì¸ì˜ `securityMatcher`ë¡œ ìš”ì²­ ê²½ë¡œë¥¼ ë§¤ì¹­í•˜ë©°, ì²« ë²ˆì§¸ë¡œ ë§¤ì¹­ë˜ëŠ” ì²´ì¸ì´ í•´ë‹¹ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì–´ë–¤ ì²´ì¸ì—ë„ ë§¤ì¹­ë˜ì§€ ì•Šìœ¼ë©´ Spring Security í•„í„°ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  DispatcherServletìœ¼ë¡œ ë°”ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” Admin API(`/api/v1/admin/**`)ì™€ User API(`/api/**` + OAuth2 ê²½ë¡œ)ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì„œë¡œ ë‹¤ë¥¸ ì¸ì¦ ë°©ì‹ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.

**ğŸ’¡ í¬ì¸íŠ¸**:
- Filter Chain ë§¤ì¹­ ìˆœì„œì™€ ìš°ì„ ìˆœìœ„
- securityMatcherì™€ authorizeHttpRequestsì˜ ì°¨ì´
- ë‹¤ì¤‘ ì²´ì¸ì„ ì‚¬ìš©í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ (Admin/User ë¶„ë¦¬)

---

### Q4. OAuth2 Authorization Code Flowì—ì„œ state íŒŒë¼ë¯¸í„°ì˜ ì—­í• ì€ ë¬´ì—‡ì¸ê°€ìš”?
**A**: state íŒŒë¼ë¯¸í„°ëŠ” CSRF(Cross-Site Request Forgery) ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ë³´ì•ˆ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. ì¸ì¦ ìš”ì²­ ì‹œ ìƒì„±ëœ ëœë¤ ê°’ì„ ì¿ í‚¤ì— ì €ì¥í•˜ê³ , OAuth2 Providerê°€ ì½œë°± ì‹œ ë™ì¼í•œ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤. ì„œë²„ëŠ” ì¿ í‚¤ì— ì €ì¥ëœ ê°’ê³¼ ì½œë°±ìœ¼ë¡œ ë°›ì€ ê°’ì„ ë¹„êµí•˜ì—¬ ìš”ì²­ì˜ ì •ë‹¹ì„±ì„ ê²€ì¦í•©ë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì¿ í‚¤ê°€ ì „ì†¡ë˜ì§€ ì•Šì•„ ì €ì¥ëœ state ê°’ì„ ì°¾ì§€ ëª»í•´ ê²€ì¦ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.

**ğŸ’¡ í¬ì¸íŠ¸**:
- OAuth2 ë³´ì•ˆ ì·¨ì•½ì ê³¼ ëŒ€ì‘ ë°©ì•ˆ
- state íŒŒë¼ë¯¸í„° ì €ì¥/ê²€ì¦ ë©”ì»¤ë‹ˆì¦˜
- HttpCookieOAuth2AuthorizationRequestRepositoryì˜ ì—­í• 

---

### Q5. ALB(Application Load Balancer) í™˜ê²½ì—ì„œ HTTPS ê°ì§€ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í–ˆë‚˜ìš”?
**A**: ALBì—ì„œ SSL/TLS ì¢…ë£Œ(termination)ë¥¼ ìˆ˜í–‰í•˜ë©´ ë°±ì—”ë“œ EC2ë¡œëŠ” HTTPë¡œ ìš”ì²­ì´ ì „ë‹¬ë©ë‹ˆë‹¤. ì´ ê²½ìš° `request.isSecure()`ë§Œìœ¼ë¡œëŠ” ì›ë³¸ í”„ë¡œí† ì½œì„ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ALBëŠ” ì›ë³¸ í”„ë¡œí† ì½œ ì •ë³´ë¥¼ `X-Forwarded-Proto` í—¤ë”ì— ë‹´ì•„ ì „ë‹¬í•˜ë¯€ë¡œ, `request.isSecure() || "https".equalsIgnoreCase(request.getHeader("X-Forwarded-Proto"))` ì¡°í•©ìœ¼ë¡œ HTTPS í™˜ê²½ì„ ì •í™•í•˜ê²Œ ê°ì§€í–ˆìŠµë‹ˆë‹¤.

**ğŸ’¡ í¬ì¸íŠ¸**:
- í”„ë¡ì‹œ/ë¡œë“œë°¸ëŸ°ì„œ í™˜ê²½ì—ì„œì˜ HTTP í—¤ë” ì²˜ë¦¬
- X-Forwarded-* í—¤ë” ì¢…ë¥˜ (Proto, For, Host)
- SSL Terminationì˜ ì¥ë‹¨ì 

---

### Q6. ì´ ë¬¸ì œ í•´ê²° ê²½í—˜ì—ì„œ ì–»ì€ êµí›ˆì€ ë¬´ì—‡ì¸ê°€ìš”?
**A**: ë„¤ ê°€ì§€ í•µì‹¬ êµí›ˆì´ ìˆìŠµë‹ˆë‹¤. ì²«ì§¸, SecurityFilterChain ì„¤ê³„ ì‹œ OAuth2, Actuator ë“± í”„ë ˆì„ì›Œí¬ê°€ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ê²½ë¡œë¥¼ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. ë‘˜ì§¸, í™˜ê²½ì— ë”°ë¼ ë‹¬ë¼ì§€ëŠ” ì„¤ì •(ì¿ í‚¤ ë³´ì•ˆ, CORS ë“±)ì€ í•˜ë“œì½”ë”©í•˜ì§€ ì•Šê³  ë™ì ìœ¼ë¡œ ê°ì§€í•˜ê±°ë‚˜ ì™¸ë¶€ ì„¤ì •ìœ¼ë¡œ ë¶„ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤. ì…‹ì§¸, í”„ë¡ì‹œ í™˜ê²½ì—ì„œëŠ” X-Forwarded-* í—¤ë”ë¥¼ ë°˜ë“œì‹œ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. ë„·ì§¸, ì¸ì¦ íë¦„ ê°™ì€ ì¤‘ìš”í•œ ë¶€ë¶„ì—ëŠ” ì¶©ë¶„í•œ ë¡œê¹…ì„ ì¶”ê°€í•˜ì—¬ ë¬¸ì œ ë°œìƒ ì‹œ ë¹ ë¥¸ ì§„ë‹¨ì´ ê°€ëŠ¥í•˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.

**ğŸ’¡ í¬ì¸íŠ¸**:
- Security ì„¤ì •ì˜ ë³µì¡ì„±ê³¼ í…ŒìŠ¤íŠ¸ì˜ ì¤‘ìš”ì„±
- í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬ ì›ì¹™
- Observability (ë¡œê¹…, ëª¨ë‹ˆí„°ë§)ì˜ ì¤‘ìš”ì„±

---

## ğŸ“ ì°¸ê³  ìë£Œ (References)

### ê´€ë ¨ ë¬¸ì„œ
- [SecurityConfig.java](../src/main/java/com/tradingpt/tpt_api/global/config/SecurityConfig.java)
- [HttpCookieOAuth2AuthorizationRequestRepository.java](../src/main/java/com/tradingpt/tpt_api/domain/auth/repository/HttpCookieOAuth2AuthorizationRequestRepository.java)
- [CustomOAuth2UserService.java](../src/main/java/com/tradingpt/tpt_api/domain/auth/security/CustomOAuth2UserService.java)

### ì™¸ë¶€ ì°¸ì¡°
- [Spring Security OAuth2 Reference](https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html)
- [OAuth 2.0 Authorization Code Flow](https://datatracker.ietf.org/doc/html/rfc6749#section-4.1)
- [AWS ALB HTTP Headers](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/x-forwarded-headers.html)

---

## ğŸ“ ë³€ê²½ ì´ë ¥ (Change Log)

| ë²„ì „ | ë‚ ì§œ | ì‘ì„±ì | ë³€ê²½ ë‚´ìš© |
|------|------|--------|----------|
| 1.0.0 | 2025-11-25 | TradingPT Dev Team | ìµœì´ˆ ì‘ì„± |
| 1.1.0 | 2025-11-26 | TradingPT Dev Team | í…ŒìŠ¤íŠ¸ ê²€ì¦ ë° ë©´ì ‘ Q&A ì„¹ì…˜ ì¶”ê°€ |
