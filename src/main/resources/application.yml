spring:
  application:
    name: TradingPT

  profiles:
    active: ${SPRING_PROFILES_ACTIVE}

  # 공통 데이터소스 설정
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 20000
      idle-timeout: 300000
      max-lifetime: 1200000

  # 공통 JPA 설정
  jpa:
    properties:
      hibernate:
        jdbc:
          batch_size: 1000
          lob:
            non_contextual_creation: true
        order_inserts: true
        order_updates: true
        generate_statistics: false
        cache:
          use_second_level_cache: false
          use_query_cache: false
    open-in-view: false

  # 공통 세션 설정
  servlet:
    session:
      timeout: 24h
      store-type: redis
      tracking-modes: cookie
    multipart:
      enabled: true
      max-file-size: 200MB
      max-request-size: 300MB
      file-size-threshold: 2KB    # 메모리에서 디스크로 옮기는 임계값
      location: ${java.io.tmpdir} # 임시 파일 저장 위치
    cookie:
      same-site: none
      secure: true

  # 메일 설정
  mail:
    host: smtp-relay.gmail.com
    port: 587
    properties:
      mail.smtp.auth: false
      mail.smtp.starttls.enable: true
      mail.smtp.starttls.required: true
      mail.debug: true


  # OAuth2 설정
  security:
    oauth2:
      client:
        registration:
          kakao:
            client-name: kakao
            client-id: ${KAKAO_CLIENT_ID}
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
            scope:
              - profile_nickname
              - account_email
          naver:
            client-name: naver
            client-id: ${NAVER_CLIENT_ID}
            client-secret: ${NAVER_CLIENT_SECRET}
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
            scope:
              - name
              - email
        provider:
          kakao:
            authorization-uri: https://kauth.kakao.com/oauth/authorize
            token-uri: https://kauth.kakao.com/oauth/token
            user-info-uri: https://kapi.kakao.com/v2/user/me
            user-name-attribute: id
          naver:
            authorization-uri: https://nid.naver.com/oauth2.0/authorize
            token-uri: https://nid.naver.com/oauth2.0/token
            user-info-uri: https://openapi.naver.com/v1/nid/me
            user-name-attribute: response

# Swagger 설정
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    groups-order: DESC
    operationsSorter: method
    disable-swagger-default-url: true
    display-request-duration: true
    try-it-out-enabled: true
  api-docs:
    path: /v3/api-docs
  default-consumes-media-type: application/json
  default-produces-media-type: application/json

# Security 설정
security:
  rememberme:
    key: ${REMEMBER_ME_KEY}
    validity-seconds: 1209600

# 서버 설정
server:
  port: 8080
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true
  forward-headers-strategy: native
  error:
    include-stacktrace: never
    include-message: always

# 액추에이터 설정
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus  # metrics 추가
  endpoint:
    health:
      show-details: when-authorized
    metrics:
      enabled: true

# 애플리케이션 설정
app:
  mail:
    from: ${MAIL_NAME}
  frontend:
    base-url: http://localhost:3000
  cors:
    allowed-origins:
      - http://localhost:3000
      - http://localhost:5173
      - http://localhost:8080
    exposed-headers:
      - XSRF-TOKEN
  swagger:
    title: Trading PT API
    description: Trading Platform API 문서
    version: "1.0"
    servers:
      - url: http://localhost:8080
        description: 로컬 API 서버

# SMS 설정
solapi:
  api-key: ${SOLAPI_API_KEY}
  api-secret: ${SOLAPI_API_SECRET}
  sender-number: ${SOLAPI_PHONE_NUMBER}

# NicePay 설정
nicepay:
  api:
    base-url: https://webapi.nicepay.co.kr/webapi
    billing-register-path: /billing/cardbill_regist.jsp
    billing-direct-register-path: /billing/billing_regist.jsp
    billing-delete-path: /billing/billkey_remove.jsp
    billing-approve-path: /billing/billing_approve.jsp
  credentials:
    mid: ${NICEPAY_MID}
    merchant-key: ${NICEPAY_MERCHANT_KEY}
  defaults:
    goods-name: "구독 결제 수단 등록"
    amt: "0"
  feign:
    connect-timeout: 10
    read-timeout: 15
    logger-level: BASIC
    follow-redirects: true

# 로깅 설정 (공통)
logging:
  level:
    org.springframework.security: DEBUG
    com.tradingpt.tpt_api.auth.filter: DEBUG
    org.springframework.security.web.authentication.rememberme: DEBUG

aligo:
  user-id: "${ALIGO_USER_ID}"
  api-key: "${ALIGO_API_KEY}"
  senderkey: "${ALIGO_SENDER_KEY}"
  sender: "${ALIGO_SENDER_NUMBER}"

  template:
    join: "${ALIGO_TEMPLATE_JOIN}"              # 회원가입 템플릿 코드
    join-approved: "${ALIGO_TEMPLATE_JOIN_APPROVED}" # 가입 승인 템플릿 코드
