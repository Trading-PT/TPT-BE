spring:
  config:
    activate:
      on-profile: prod

  datasource:
    url: jdbc:mysql://${PROD_DB_HOST}:3306/${PROD_DB_NAME}?serverTimezone=Asia/Seoul&characterEncoding=UTF-8&useSSL=true&requireSSL=true&tcpKeepAlive=true&connectTimeout=10000&socketTimeout=60000
    username: ${PROD_DB_USERNAME}
    password: ${PROD_DB_PASSWORD}
    hikari:
      pool-name: HikariCP-Prod
      maximum-pool-size: 15                # 10 → 15 증가 (동시 요청 대응)
      minimum-idle: 7                      # 5 → 7 증가
      connection-timeout: 20000
      idle-timeout: 300000
      max-lifetime: 1200000
      # Stale connection 방지 설정
      keepalive-time: 30000                # 30초마다 유휴 연결 keepalive 체크
      validation-timeout: 5000             # 연결 검증 타임아웃 5초
      leak-detection-threshold: 60000      # 커넥션 누수 감지 임계값 60초

  # Redis 설정 (Encryption in-transit 활성화)
  data:
    redis:
      host: ${PROD_REDIS_HOST}
      port: 6379
      ssl:
        enabled: true
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 2

  session:
    store-type: redis
    timeout: 7d
    redis:
      configure-action: NONE
      flush-mode: immediate
      repository-type: indexed

  # OAuth2 설정 (운영 환경)
  security:
    oauth2:
      client:
        registration:
          kakao:
            client-id: ${KAKAO_CLIENT_ID}
            client-secret: ${KAKAO_CLIENT_SECRET}
            redirect-uri: https://api.tradingpt.kr/login/oauth2/code/kakao
          naver:
            client-id: ${NAVER_CLIENT_ID}
            client-secret: ${NAVER_CLIENT_SECRET}
            redirect-uri: https://api.tradingpt.kr/login/oauth2/code/naver

  # JPA 설정 (운영 환경)
  jpa:
    hibernate:
      ddl-auto: create
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        jdbc:
          batch_size: 20
        connection:
          provider_disables_autocommit: false

# 로깅 설정 (운영 환경 - 최소화)
logging:
  level:
    root: WARN
    com.tradingpt.tpt_api: INFO
    org.springframework.web: WARN
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql: WARN

aws:
  s3:
    access-key: ${AWS_ACCESS_KEY_ID}
    secret-key: ${AWS_SECRET_ACCESS_KEY}
    region: ${AWS_REGION}
    public-bucket: ${S3_BUCKET_NAME}
    private-bucket: ${S3_PRIVATE_BUCKET_NAME}

# CloudFront 운영 환경 설정
cloudfront:
  domain: ${CLOUDFRONT_DOMAIN}
  keyPairId: ${CLOUDFRONT_KEY_PAIR_ID}
  privateKey: ${CLOUDFRONT_PRIVATE_KEY}

server:
  servlet:
    session:
      cookie:
        http-only: true
        secure: true
        same-site: Lax
        path: /
#        domain: .tradingpt.kr

app:
  frontend:
    base-url: https://www.tradingpt.kr
  cors:
    allowed-origins:
      - https://www.tradingpt.kr
      - https://tradingpt.kr
      - https://api.tradingpt.kr
    exposed-headers:
      - XSRF-TOKEN
      - X-XSRF-TOKEN
  swagger:
    servers:
      - url: https://api.tradingpt.kr
        description: Production API Server

# NicePay 운영 환경 설정
nicepay:
  credentials:
    mid: ${NICEPAY_MID}
    merchant-key: ${NICEPAY_MERCHANT_KEY}
