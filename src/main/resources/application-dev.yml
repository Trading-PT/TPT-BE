spring:
  config:
    activate:
      on-profile: dev

  datasource:
    url: jdbc:mysql://${DEV_DB_HOST}:3306/${DEV_DB_NAME}?serverTimezone=Asia/Seoul&characterEncoding=UTF-8&tcpKeepAlive=true&connectTimeout=10000&socketTimeout=60000
    username: ${DEV_DB_USERNAME}
    password: ${DEV_DB_PASSWORD}
    hikari:
      pool-name: HikariCP-Dev

      # 커넥션 풀 크기 (db.t4g.medium: 4GB, max_connections ~340 대응)
      maximum-pool-size: 30             # 20 → 30 (RDS 업그레이드로 증가 가능)
      minimum-idle: 10                  # 5 → 10 (유휴 커넥션 확보)

      # 유휴 커넥션 정리
      idle-timeout: 300000              # 5분 (적절)

      # RDS 환경에서 가장 안전한 max-lifetime
      max-lifetime: 1800000             # 30분 (권장)

      # Stale connection 방지 (keepalive 제거)
      keepalive-time: 0                 # 반드시 0 (문제의 핵심 해결)

      # 커넥션이 끊겼는지 즉시 감지
      validation-timeout: 5000

      # 커넥션 누수 감지 (N+1 쿼리로 인한 긴 트랜잭션 대응)
      leak-detection-threshold: 60000   # 5초 → 60초 (오탐 방지, 실제 누수만 감지)

      # 풀에서 커넥션 가져올 때 최대 대기 시간
      connection-timeout: 20000         # 10초 → 20초 (버퍼 증가)

  # Redis 설정
  data:
    redis:
      host: ${DEV_REDIS_HOST}
      port: 6379
      ssl:
        enabled: false
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0

  session:
    timeout: 7d
    store-type: redis
    redis:
      configure-action: NONE
      flush-mode: immediate
      repository-type: indexed

  # JPA 설정 (개발 환경)
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        jdbc:
          batch_size: 1000
        connection:
          provider_disables_autocommit: false

# 로깅 설정 (개발 환경)
logging:
  level:
    root: INFO
    com.tradingpt.tpt_api: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG

aws:
  s3:
    access-key: ${AWS_ACCESS_KEY_ID}
    secret-key: ${AWS_SECRET_ACCESS_KEY}
    region: ${AWS_REGION}
    public-bucket: ${S3_BUCKET_NAME}
    private-bucket: ${S3_PRIVATE_BUCKET_NAME}

server:
  servlet:
    session:
      timeout: 3h
      cookie:
        http-only: true
        secure: true          # 운영/Dev에서 HTTPS면 true
        same-site: None       # 다른 도메인에서 쿠키 전송이 필요하면 None
        path: /

app:
  frontend:
    base-url: https://www.tradingpt.kr
  cors:
    allowed-origins:
      - https://dev.tradingpt.shop
      - https://localhost:3000
      - https://localhost:3001
      - https://www.tradingpt.kr
      - https://manage-tradingpt.vercel.app/
    
    exposed-headers:
      - XSRF-TOKEN
      - X-XSRF-TOKEN
  swagger:
    servers:
      - url: https://dev.tradingpt.kr
        description: Dev API 서버

# NicePay 로컬/테스트 환경 설정
nicepay:
  credentials:
    mid: nictest04m
    merchant-key: b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw==

# CloudFront (prod 제외 공통)
cloudfront:
  domain: ${CLOUDFRONT_DOMAIN}
  keyPairId: ${CLOUDFRONT_KEY_PAIR_ID}
  privateKey: ${CLOUDFRONT_PRIVATE_KEY}